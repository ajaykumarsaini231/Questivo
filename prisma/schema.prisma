generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model ExamCategory {
  id          String       @id @default(uuid())
  name        String       @unique          // e.g. "SSC CGL Tier 1"
  code        String?      @unique          // e.g. "SSC_CGL_T1"
  description String?
  isActive    Boolean      @default(true)

  topics   ExamTopic[]
  sessions TestSession[]
}

model ExamTopic {
  id              String        @id @default(uuid())
  examCategoryId  String
  examCategory    ExamCategory  @relation(fields: [examCategoryId], references: [id], onDelete: Cascade)

  name   String                  // e.g. "Percentage"
  code   String?                 // e.g. "PERCENTAGE"
  order  Int?                    // display order
  isActive Boolean  @default(true)

  questions       TestQuestion[]
}


model TestQuestion {
  id             String       @id @default(uuid())
  sessionId      String
  session        TestSession  @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  indexInSession Int
  examType       String       // snapshot (optional but handy)
  topic          String       // snapshot of topic name
  difficulty     String
  questionText   String
  optionA        String
  optionB        String
  optionC        String
  optionD        String
  correctOption  String
  explanation    String?

  // Proper relation to backend topic
  topicId   String?
  topicRef  ExamTopic? @relation(fields: [topicId], references: [id])

  answers        TestAnswer[]

  @@unique([sessionId, indexInSession])
}


model TestAnswer {
  id             String       @id @default(uuid())
  sessionId      String
  questionId     String

  session        TestSession  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  question       TestQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  selectedOption String
  isCorrect      Boolean
  answeredAt     DateTime     @default(now())

  @@unique([sessionId, questionId])
}

model TestSession {
  id             String         @id @default(uuid())
  examType       String         // snapshot, e.g. "SSC CGL Tier 1"
  topics         String[]       @default([])  // snapshot of chosen topics names
  difficulty     String
  sessionType    String         // "practice", "mock", etc.
  numQuestions   Int
  durationMinutes Int           @default(60)  // <-- newly added
  createdAt      DateTime       @default(now())

  // Link to backend-fixed exam category
  examCategoryId String?
  examCategory   ExamCategory? @relation(fields: [examCategoryId], references: [id])

  questions    TestQuestion[]
  answers      TestAnswer[]
}
